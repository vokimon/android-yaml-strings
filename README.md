# android-yaml-strings

A Gradle plugin to maintain Android translation strings in YAML files.

This Gradle plugin enables you to write Android translations
in easy-to-read, easy-to-write [YAML](https://yaml.org/) files
by transparently converting them
into `strings.xml` resource files
during the build process.

It also includes additional features such as:

- **Named placeholders**
- **Sections**
- **Language enumeration**

## Usage

Place your YAML translation files in:
`<module>/src/<sourceSet>/translations/<langcode>.yaml`.

These files contain mappings from string IDs to their translations in the given language (`langcode`):

```yaml
myid: This is a translation
otherid: Translate me
multiline: |>
   This content is split
   across multiple lines.
```

You can refer these strings in your code as:
`com.mydomain.myapp.R.myid`,
just like any id defined in a `strings.xml` file.

### Configuration

Enable the required repositories in `settings.gradle.kts`:

```kotlin
pluginManagement {
    repositories {
        mavenLocal() // If you install it locally
        gradlePluginPortal()
        google()
        mavenCentral()
    }
}
```

In your module `build.gradle` (Groovy DSL):

```groovy
plugins {
    id 'net.canvoki.android-yaml-strings' version '1.0.0'
}

// Optional, just add it if 'en' is not you reference language
yamlToAndroidStrings {
    defaultLanguage = "en"
}
```
or in `build.gradle.kts` (Kotlin DSL):

```kotlin
plugins {
    id("net.canvoki.android-yaml-strings") version "1.0.0"
}

// Optional, just add it if 'en' is not you reference language
yamlToAndroidStrings {
    defaultLanguage.set("en")
}
```

### Sections

You can organize your YAML using nested sections.
XML resource IDs are generated by joining section names with double underscores (`__`).

```yaml
section:
  child: My string
```

This produces the resource ID `section__child`.

### Named placeholders

Android string resources only support positional placeholders (e.g., `%1$s`).
This plugin extends that by allowing **named placeholders** in your YAML translations,
such as

```yaml
mystring: Hello {user}! Welcome to {appname}
```

This makes translations clearer -- translators understand what each placeholder means
and can reorder them as needed for gramatical correctness in their language.

However, in code you must still use positional placeholders.
The order of named placeholders in the reference language
(usually English) determines their index in the compiled resource.

Parameter names are validated at compile time to ensure correctness.

Parameters also can have format specs `{name:formatspec}`.
Use the same spec you would use in `strings.xml`

#### YAML specific gotchas

Named placeholders have some friction with YAML:

Curly braces have special meaning in YAML. If a string starts with a placeholder, wrap it in quotes:

```yaml
nloaded: "{n} items loaded"  # Prevents parsing it as an inline map
nloaded2: You have {n} items # No quotes needed if not at the starts
```

To include a literal curly brace, double it:

```yaml
bracestring: this {{curly brace}} is not a placeholder
```

### Language enumeration

The plugin generates a string array resource
named `supported_language_codes`
containing all detected language codes.
This lets your app enumerate available languages.

    Tip: Reserve a translation key like `language_name`
    to store the native name of each language for display purposes.

## Implementation details

The plugin generates intermediate in the build directory,

- `<srcSet>/res/value-<lang>/string.xml` for each language
- `<srcSet>/res/values/arrays_languages.xml` containing `supported_language_codes`

These are automatically included in your APK/AAB via Androidâ€™s resource merging.

## Development

```bash
# Pass tests
./gradlew test

# Publish to local Maven repository
./gradlew publishToMavenLocal

# Publish to plugins.gradle.org
export GRADLE_PUBLISH_KEY=xxxxxxxxxxxxxxxxxxxxxxxxx
export GRADLE_PUBLISH_SECRET=zzzzzzzzzzzzzzzzzzzzzzzzzzzz
./gradlew publish
```

